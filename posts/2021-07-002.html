<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MECAT: fast mapping, error correction, and de novo assembly for single-molecule sequencing reads | The World</title><meta name="keywords" content="MECAT fast mapping, error correction, and de novo assembly for single-molecule sequencing reads, long read error correction and assembly"><meta name="author" content="归去来兮"><meta name="copyright" content="归去来兮"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="MECAT: fast mapping, error correction, and de novo assembly for single-molecule sequencing reads  仅代表个人理解，如果有不准确的欢迎指正   可能会用到的知识点  SMS:single-molecule sequencing 单分子测序技术 mapping：只提供read比对的参考序列上的位置信息；">
<meta property="og:type" content="article">
<meta property="og:title" content="MECAT: fast mapping, error correction, and de novo assembly for single-molecule sequencing reads">
<meta property="og:url" content="http://slyli.cn/posts/2021-07-002.html">
<meta property="og:site_name" content="The World">
<meta property="og:description" content="MECAT: fast mapping, error correction, and de novo assembly for single-molecule sequencing reads  仅代表个人理解，如果有不准确的欢迎指正   可能会用到的知识点  SMS:single-molecule sequencing 单分子测序技术 mapping：只提供read比对的参考序列上的位置信息；">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://slyli.github.io/img2/fav-sfw/wallhaven-01kgv4.jpg">
<meta property="article:published_time" content="2021-07-15T13:00:28.000Z">
<meta property="article:modified_time" content="2021-07-20T11:57:05.668Z">
<meta property="article:author" content="归去来兮">
<meta property="article:tag" content="bioinformatics">
<meta property="article:tag" content="essay">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://slyli.github.io/img2/fav-sfw/wallhaven-01kgv4.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/favicon.png"><link rel="canonical" href="http://slyli.cn/posts/2021-07-002"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta name="msvalidate.01" content="40800d7ddbfe4bc789367280a8addd52"/><meta name="baidu-site-verification" content="G9pFOrKi8Sw1jxpS"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6facd0f053c5c32a56f404f1655089bb";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-07-20 19:57:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/ava1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">43</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">35</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> Article</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-cube"></i><span> Entertain</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/steam/"><i class="fa-fw fab fa-steam"></i><span> Steam</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-folder"></i><span> Others</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/comment/"><i class="fa-fw fas fa-comment"></i><span> Comment</span></a></li><li><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></li><li><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://cloud.slyli.cn/cloud/"><i class="fa-fw fas fa-cloud"></i><span> Cloud</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://v.slyli.cn"><i class="fa-fw fa fa-clone"></i><span> Mirror</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa-fw fas fa-cubes"></i><span> Saying</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://slyli.github.io/img2/fav-sfw/wallhaven-01kgv4.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">The World</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> Article</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-cube"></i><span> Entertain</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/steam/"><i class="fa-fw fab fa-steam"></i><span> Steam</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-folder"></i><span> Others</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/comment/"><i class="fa-fw fas fa-comment"></i><span> Comment</span></a></li><li><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></li><li><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://cloud.slyli.cn/cloud/"><i class="fa-fw fas fa-cloud"></i><span> Cloud</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://v.slyli.cn"><i class="fa-fw fa fa-clone"></i><span> Mirror</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa-fw fas fa-cubes"></i><span> Saying</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MECAT: fast mapping, error correction, and de novo assembly for single-molecule sequencing reads</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-07-15T13:00:28.000Z" title="Created 2021-07-15 21:00:28">2021-07-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-07-20T11:57:05.668Z" title="Updated 2021-07-20 19:57:05">2021-07-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Master/">Master</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">2.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>7min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/2021-07-002.html#post-comment"><span class="gitalk-comment-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="mecat-fast-mapping-error-correction-and-de-novo-assembly-for-single-molecule-sequencing-reads"><a class="markdownIt-Anchor" href="#mecat-fast-mapping-error-correction-and-de-novo-assembly-for-single-molecule-sequencing-reads"></a> <a target="_blank" rel="noopener" href="https://www.nature.com/articles/nmeth.4432">MECAT: fast mapping, error correction, and de novo assembly for single-molecule sequencing reads</a></h1>
<blockquote>
<p>仅代表个人理解，如果有不准确的欢迎指正</p>
</blockquote>
<h2 id="可能会用到的知识点"><a class="markdownIt-Anchor" href="#可能会用到的知识点"></a> 可能会用到的知识点</h2>
<ul>
<li>SMS:single-molecule sequencing 单分子测序技术</li>
<li>mapping：只提供read比对的参考序列上的位置信息；alignment：不仅提供位置信息，还有他们的实际位点和参考位点之间的匹配、不匹配、插入或删除的关系</li>
<li>global alignment ：需要比对整个查询序列，查询序列在参考序列上的比对结果可能会不连续，一般用来比较同源基因，或者基因的差异性</li>
<li>local alignment ：查找最能匹配上参考序列的局部区域，比对上的结果可能是查询序列的子序列，</li>
<li>Chimeric reads : occur when one sequencing read aligns to two distinct portions of the genome with little or no overlap. Chimeric reads are indicative of structural variation. Chimeric reads are also called split reads.</li>
<li>contig : 重叠的read，根据read之间公共的片段形成</li>
<li>DAG: Directed Acyclic Graph 有向无环图，图中从任意顶点出发无法经过若干条边回到该点</li>
<li>DAGCon:</li>
</ul>
<h2 id="main"><a class="markdownIt-Anchor" href="#main"></a> Main</h2>
<p>SMS read 的 alignment 是非常耗时的，通常基于k-mer的方法是找种子（read 中的一段） 进行read间的alignment，但由于生物学基因的的重复性，位于重复区的read的k-mer能够匹配上的数量非常高，这会导致有额外的候选者，忽略高重复率的k-mer可能导致缺失正确的overlap，BLASR中是利用稀疏的动态规划来完成的，最近，canu中使用tf-idf k-mer weighting 方法来减少高重复k-mer的影响，但canu没有考虑k-mer之间的排列。</p>
<p>本文中的方法是使用距离影响因子DDF（distance difference factors）给k-mer对打分，包括所有的匹配k-mer对和他们的内部距离，因此，这个分数可以表示read之间的全局匹配信息，通过提取高分数的read pair来过滤不合适的候选者<br />
<img src= "https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/loading.gif" data-lazy-src="https://media.springernature.com/full/springer-static/image/art%3A10.1038%2Fnmeth.4432/MediaObjects/41592_2017_Article_BFnmeth4432_Fig1_HTML.jpg" width="70%"></p>
<pre><code>- a 两个read上block间的 k-mer alignment
- b 在block对里面，使用DDF对k-mer对打分，
- c 选择分数最高的作为k-mer种子，有分数相同的就随机选，（彩旗表示）
- d 加上其他block的k-mer对，对k-mer种子打分
- e 进行 sequence alignment
</code></pre>
<p>基于DDF score 算法，本文提供了 MECAT ，一个快速的比对工具，运行时可以选择是否使用 local alignment 。我们可以仅根据DDF分数来选择可靠的read对，当只需要候选匹配对时，我们可以不进行local alignment 。</p>
<p>DDF alignment score 对 overlap 长度敏感，所以MECAT 也适合 read到参考基因上的比对</p>
<p>由于SMS read的高错误率，必须要进行纠错，纠错后的read一般是根据一定数量匹配read的共同部分进行构建的，MECAT可以不使用local alignment 快速选择候选read</p>
<h2 id="methods"><a class="markdownIt-Anchor" href="#methods"></a> Methods</h2>
<blockquote>
<p>自己暂时只用 correct 和 assembly<br />
template read 自己预先给定的 read</p>
</blockquote>
<h3 id="correcting-single-molecule-sequencing-reads"><a class="markdownIt-Anchor" href="#correcting-single-molecule-sequencing-reads"></a> Correcting single-molecule sequencing reads.</h3>
<p>一般来说，纠错有两个步骤，第一步是在成对的read之间查找overlap，第二步是根据相关 alignment 结果中的一致（consensus）部分构建正确的结果</p>
<p>在第一步中，我们使用不带 local alignment 的 MECAT 查找 overlap ， 输出放在多个文件中，每个文件包括200000个read 的 overlap 匹配信息，对于每个 read 的匹配信息，我们根据DDF score 降序排序，我们在read和相匹配的read间，从DDF score最高的开始，进行 local alignment，为消除chimeric（嵌合） read和重复子序列的影响，过滤掉 overlap 长度小于 read pair 中长度较短的 read 90% 长度的 alignment 结果，一旦收到到了100个 overlaps 或者 align 了所有 read 就停止 local alignment。因为避免了计算不相关的overlaps可以加快alignment的时间。</p>
<p>第二步中，为了提高准确性和保持高效性，提出了结合 DAGCon and FalconSense 概念的一种新的适应性的 SMS read 纠错方法。总结了每对的比对结果，使用每个 base 上匹配，插入、删除的 read 数量构建了一个 consensus table<br />
match_count,碱基位置能够相匹配的read的数量，insertion、deletion 同理</p>
<ol>
<li>认定为匹配条件： match_count/(match_count + deletion_count) &gt; 0.8 and insertion_count &lt; 6</li>
<li>认定为删除条件： deletion_count/(match_count + deletion_count) &gt; 0.8 and insertion_count &lt; 6</li>
<li>对于更复杂的插入的情况，构建了一个局部 POG 并使用了动态规划来解决，因为复杂区域的一般来说小于 10 个 base ，通过小的 POG 可以很快的找到 consensus 具体细节见下方 Supplementary</li>
</ol>
<p>第二步中，再模板read 和相匹配的 read 间进行 local alignment 时，需要随机读取储存的read，DAGCon 和 FalconSense 把 read 放到硬盘中，不支持随机读取。为了加速纠错过程，把所有的read都加载到内存中了</p>
<h3 id="de-novo-assembly-using-single-molecule-sequencing-reads"><a class="markdownIt-Anchor" href="#de-novo-assembly-using-single-molecule-sequencing-reads"></a> De novo assembly using single-molecule sequencing reads.</h3>
<p>使用 SMS read 组装基因组有三步：找到 reads 和 template reads 间的 overlap，对 template reads 纠错，使用纠错后的 reads 构建 contigs。本文通过整合 canu 和新的 alignment 和纠错方法开发了两个新的pipeline。在 MECAT pipeline 的第一步，对所有超过3000bp的read运行分别进行alignment，从匹配上的read中选择分数最高的100个，在找overlap的过程中，不进行local alignment 使用mapping 信息进行纠错，第二步，用能够匹配到 template reads （&gt;3000bp）的 read 对 template reads 纠错，最后，把纠错后的 read 使用 MECAT 中的 alignment 工具进行 alignment，然后把这些 alignment 结果放到 Canu 的 Unitig Construction 模型中去构建 unitigs 。或者直接把纠错后的read放到canu里。</p>
<h2 id="supplementary"><a class="markdownIt-Anchor" href="#supplementary"></a> Supplementary</h2>
<p><a target="_blank" rel="noopener" href="https://www.nature.com/articles/nbt.2280">DAGCon</a> , <a target="_blank" rel="noopener" href="https://genome.cshlp.org/content/27/5/722">FC_consensus</a> 和 <a target="_blank" rel="noopener" href="https://www.nature.com/articles/nmeth.4035">FalconSense</a>是三个被广泛使用的 consensus 算法。他们有以下步骤：</p>
<ol>
<li>根据两个 read 间的 alignment 构建一个多重序列的 alignment (multiple sequence alignment, MSA)</li>
<li>从多重 alignment 列中选择正确的碱基（base)</li>
</ol>
<p>DAGCon 使用有向无环图将MSA编码成偏序 alignment （这应该和我之前代码的想法一致）。然而 FC_consensus 和 FalconSense 根据 base-level 的一致性和 偏序 alignment 使用标记和排序的方法构建一致性序列。</p>
<pre><code>不太懂，等看了论文之后再重新整吧
</code></pre>
<p>DAGCon 有最高的准确性和最慢的速度（自己之后应该会选择这种方法，现在需要做的可能是找一个更准确的local alignment 工具，minimap2 的结果准确率只有95%，还是有点低，导致生成的一致性序列错误率很高，这个虽然可以通过多重纠错来解决，不过这就更麻烦了）</p>
<p>在研究中，提出了一个结合 DAGCon 和 FalconSense 概念的一个新的算法：在不重要的区域上，使用和 FalconSense 一样的基于计数的纠错方法，但在复杂区域（删除区域）通过 DAGCon 算法处理，但复杂区域一般都小于10个 base ， 所以可以处理的很快</p>
<h3 id="mecat2cns"><a class="markdownIt-Anchor" href="#mecat2cns"></a> MECAT2CNS</h3>
<p><img src= "https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/2021-07/mecat.png" alt="cns figure" /><br />
程序输入包含一个模板 read 和一组其他 read</p>
<ol>
<li>构建一个 consensus table ，每个 base 都有匹配 mat 、插入 ins 、删除 del 三项记录表，分别记录匹配的个数，和在这个碱基后插入和删除的个数。</li>
<li>把所有 read align 到模板read上，如果首尾不匹配，可以截断头或尾以提高准确性</li>
<li>根据 alignment 的结果在表中填入相应的值</li>
<li>删掉不重要的计数 ： mat + del &lt; c ; ins &lt; c</li>
<li>对于每列中
<ul>
<li>mat/(mat + del) &gt; 0.8 认定为 firmly matched point fmp ；</li>
<li>del/(mat + del) &gt; 0.8  认定为 firmly deletion point fdp ;</li>
<li>否则为不确定的点 underdetermined point fp</li>
</ul>
</li>
<li>扫描整个 table，
<ul>
<li>如果是 fmp ，添加到 consensus 序列中，然后处理下一个</li>
<li>如果不是，继续扫描知道找到下一个 fmp ，如果这个之间只有 fdp，没有插入，则去除这段区域，否则定义为复杂区域，然后使用 DAGCon 算法处理，输出添加到一致性序列中，然后继续扫描。</li>
</ul>
</li>
</ol>
<h2 id="本论文的大致写作思路"><a class="markdownIt-Anchor" href="#本论文的大致写作思路"></a> 本论文的大致写作思路</h2>
<ol>
<li>先介绍背景，三代测序数据。</li>
<li>介绍前人的工作结果和进展，部分会分析或者指出不足的地方</li>
<li>然后引出本文的主要内容方法和做出的成果，并且进行成果分析，以及和其他现有工具对结果进行比较</li>
<li>然后就是方法部分，分别就本文中的各个部分较为详细的介绍一一下自己的思路，具体的细节可能会放到 Supplementary 中说明</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">归去来兮</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://slyli.cn/posts/2021-07-002.html">http://slyli.cn/posts/2021-07-002.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/bioinformatics/">bioinformatics</a><a class="post-meta__tags" href="/tags/essay/">essay</a></div><div class="post_share"><div class="social-share" data-image="https://slyli.github.io/img2/fav-sfw/wallhaven-01kgv4.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/2021-07-003.html"><img class="prev-cover" data-lazy-src="https://slyli.github.io/img2/fav-sfw/wallhaven-0je5xw.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Phased diploid genome assembly with single-molecule real-time sequencing</div></div></a></div><div class="next-post pull-right"><a href="/posts/2021-07-001.html"><img class="next-cover" data-lazy-src="https://slyli.github.io/img2/fav-sfw/wallhaven-012339.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">获取JD_COOKIE</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/2021-07-240.html" title="Canu: scalable and accurate long-read assembly via adaptive k-mer weighting and repeat separation"><img class="cover" data-lazy-src="https://slyli.github.io/img2/fav-sfw/wallhaven-0jepq4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-24</div><div class="title">Canu: scalable and accurate long-read assembly via adaptive k-mer weighting and repeat separation</div></div></a></div><div><a href="/posts/2021-07-003.html" title="Phased diploid genome assembly with single-molecule real-time sequencing"><img class="cover" data-lazy-src="https://slyli.github.io/img2/fav-sfw/wallhaven-0je5xw.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-20</div><div class="title">Phased diploid genome assembly with single-molecule real-time sequencing</div></div></a></div><div><a href="/posts/2021-09-150.html" title="DAGCON"><img class="cover" data-lazy-src="https://slyli.github.io/img2/fav-sfw/wallhaven-0pkex9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-15</div><div class="title">DAGCON</div></div></a></div><div><a href="/posts/2021-03-002.html" title="基因组文件处理"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/gh/slyli/img1/wallpaper/wallhaven-xlq1rv.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-17</div><div class="title">基因组文件处理</div></div></a></div><div><a href="/posts/2021-03-001.html" title="基因组组装"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/gh/slyli/img1/wallpaper/wallhaven-vg7lv3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-11</div><div class="title">基因组组装</div></div></a></div><div><a href="/posts/2021-03-003.html" title="测序数据解释"><img class="cover" data-lazy-src="https://slyli.github.io/img2/fav-sfw/wallhaven-011zk3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-22</div><div class="title">测序数据解释</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Gitalk</span><span class="switch-btn"></span><span class="second-comment">Valine</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#mecat-fast-mapping-error-correction-and-de-novo-assembly-for-single-molecule-sequencing-reads"><span class="toc-number">1.</span> <span class="toc-text"> MECAT: fast mapping, error correction, and de novo assembly for single-molecule sequencing reads</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%83%BD%E4%BC%9A%E7%94%A8%E5%88%B0%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">1.1.</span> <span class="toc-text"> 可能会用到的知识点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#main"><span class="toc-number">1.2.</span> <span class="toc-text"> Main</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#methods"><span class="toc-number">1.3.</span> <span class="toc-text"> Methods</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#correcting-single-molecule-sequencing-reads"><span class="toc-number">1.3.1.</span> <span class="toc-text"> Correcting single-molecule sequencing reads.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#de-novo-assembly-using-single-molecule-sequencing-reads"><span class="toc-number">1.3.2.</span> <span class="toc-text"> De novo assembly using single-molecule sequencing reads.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#supplementary"><span class="toc-number">1.4.</span> <span class="toc-text"> Supplementary</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mecat2cns"><span class="toc-number">1.4.1.</span> <span class="toc-text"> MECAT2CNS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E8%AE%BA%E6%96%87%E7%9A%84%E5%A4%A7%E8%87%B4%E5%86%99%E4%BD%9C%E6%80%9D%E8%B7%AF"><span class="toc-number">1.5.</span> <span class="toc-text"> 本论文的大致写作思路</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 归去来兮</div><div class="footer_custom_text">All Right Reserved  <a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/"><img class="icp-icon" src="https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/icp.png"><span>鲁ICP备2021044846号-1</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: 'e19f7a3f5790b3cdd656',
      clientSecret: '4c94d6a5fdffc731957d1222b75df676b21e4fcc',
      repo: 'slyli.github.io',
      owner: 'SlyLi',
      admin: ['SlyLi'],
      id: '6e5a0c936a1126217290772042bcec62',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'a6SkEWr1cDgiFLXRdcU3DkUn-gzGzoHsz',
      appKey: 'LaMtrAthbpM4HvRmTUUilSbo',
      placeholder: '昵称框输入QQ号自动获取必填信息~',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Gitalk' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<[^>]+>/g,"") // remove html tag
    content = content.replace(/(http(s?):)([/|.|\w|\s|-])*\.(?:jpg|jpeg|gif|png|webp)/g, '') // remove image link
    content = content.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi, '') // remove url

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    fetch('https://api.github.com/repos/https://github.com/SlyLi/slyli.github.io/issues/comments?sort=updated&direction=desc&per_page=6&page=1')
      .then(response => response.json())
      .then(data => {
        const githubArray = data.map(item => {
          return {
            'avatar': item.user.avatar_url,
            'content': changeContent(item.body),
            'nick': item.user.login,
            'url': item.html_url,
            'date': item.updated_at
          }
        })
        saveToLocal.set('github-newest-comments', JSON.stringify(githubArray), 10/(60*24))
        generateHtml(githubArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "Unable to get the data, please make sure the settings are correct."
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          let name = 'src'
          if(true) {
            name = 'data-lazy-src'
          }
          result += `<a href='${array[i].url}' class="thumbnail"><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick}</span><time> / ${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('github-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div> <div class="aplayer no-destroy" data-id="6888515029" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" data-mutex="true"	 muted></div> <script type="text/javascript">
function PlayerVisibility() { var pathname = document.location.pathname; var box = document.getElementsByClassName("aplayer no-destroy")[0];
if(box) { if(pathname == "/music/") { box.style.visibility="hidden"; aplayers[0].pause(); } else { box.style.visibility="visible"; aplayers[0].play(); } } } </script>
<img src = "https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/aerith1.png" id="aerith" style=" opacity:0.4; position:fixed; left:20px; bottom:80px; height:60px; z-index:10; " />
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script type="text/javascript"> function Aerith(){var set_h = window.screen.height*0.7;var timer = null;$("#aerith").mouseover(function(){$("#aerith").css("opacity","1.0");});$("#aerith").mouseout(function(){if($("#aerith").height()<300)$("#aerith").css("opacity","0.4");});var url = "https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/config";	var ZGF0YTp = "ZGF0YTpkYXRhOmltYWdlL3BuZztiYXNlNjQs";var cnt =0;$("#aerith").click(function(){cnt++;timer = setTimeout(function(){switch (cnt) {case 1:if($("#aerith").height()<300){$("#aerith").height(set_h);$("#aerith").css("opacity","1.0");}else {$("#aerith").height(60);$("#aerith").css("opacity","0.4");}break;case 2:if($("#aerith").attr("src") == "https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/aerith1.png")$("#aerith").attr("src","https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/aerith2.png");else  $("#aerith").attr("src","https://cdn.jsdelivr.net/gh/slyli/slyli.github.io/image/static/aerith1.png");break;case 3:break;case 4:var htmlobj= $.ajax({url:url,async:false}); $("#aerith").attr("src",window.atob(ZGF0YTp)+ htmlobj.responseText);default:break;}clearTimeout(timer);cnt =0;    }, 440);}); } Aerith(); </script> </div>
<script type="text/javascript"> var title2="msg=哥哥~~ 您的博客又有新评论啦~   ฅ(๑ ̀ㅅ ́๑)ฅ \n"; var SCKEY_Qmsg="https://qmsg.zendee.cn:443/send/ce2e5ff5e06719f8e3e96f3ab08aed67"; function send_valine_Qmsg(){ var pagename=document.title; var wz=pagename.indexOf('|'); var res=pagename.substring(0,wz); var pageurl=document.URL; var ptime=new Date(); var vnick=document.getElementsByClassName("vnick vinput")[0].value; var vmail=document.getElementsByClassName("vmail vinput")[0].value; var vlink=document.getElementsByClassName("vlink vinput")[0].value; var veditor=document.getElementsByClassName("veditor vinput")[0].value; var data="昵称："+vnick+"\n邮箱："+vmail+"\n网站地址："+vlink+"\n当前页面："+pagename+"\n评论内容："+veditor+"\n跳转链接："+pageurl+"\n评论时间："+ptime.toLocaleString(); var httpRequest = new XMLHttpRequest(); httpRequest.open('POST',SCKEY_Qmsg, true); httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded"); httpRequest.send(title2+data); }; function AddToButton() { var ValineButton=document.getElementsByClassName("vsubmit vbtn")[0]; if(ValineButton!=null) ValineButton.onclick=send_valine_Qmsg; var GitalkButton = document.getElementsByClassName("gt-btn gt-btn-public")[0]; if(GitalkButton!=null) GitalkButton.onclick=send_valine_Qmsg; } var myInterval; function FirstSetGitalk() { var GitalkButton = document.getElementsByClassName("gt-btn gt-btn-public")[0]; if(GitalkButton!=null) { GitalkButton.onclick=send_valine_Qmsg; clearInterval(myInterval); }
} function CommentOnload() { AddToButton(); var SwitchButton = document.getElementsByClassName("switch-btn")[0]; if(SwitchButton!=null) { SwitchButton.onclick=AddToButton; myInterval = setInterval(FirstSetGitalk,200); } }
function whenDOMReady() { CommentOnload(); console.log("ready"); } window.onload=function() { whenDOMReady(); var pjax = new Pjax(); document.addEventListener("pjax:success", whenDOMReady) };
</script>
<script type="text/javascript"> (function(){ var bp = document.createElement('script'); var curProtocol = window.location.protocol.split(':')[0]; if (curProtocol === 'https') { bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'; } else { bp.src = 'http://push.zhanzhang.baidu.com/push.js'; } var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(bp, s); })(); </script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config_change',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', '', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})</script><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>